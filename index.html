<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Farm Management PWA for Dairy and Poultry Farmers">
    <title>Farm Management PWA</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Farm Management">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="msapplication-TileColor" content="#4CAF50">
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Icons -->
    <link rel="icon" href="https://cdn.jsdelivr.net/npm/emoji-datasource-emoji@14.0.0/img/apple/64/1f33f.png" type="image/x-icon">
    <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/npm/emoji-datasource-emoji@14.0.0/img/apple/64/1f33f.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Firebase SDK (ONLY if you have real config) -->
    <!-- Comment these out if you don't have Firebase setup yet -->
    <!-- 
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    -->
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
    <script src="js/debug.js"></script>
    <script src="js/emergency-fix.js"></script>
<body>
    <!-- Welcome/Livestock Selection Screen -->
    <div id="welcome-screen" class="screen active">
        <div class="welcome-container">
            <div class="welcome-header">
                <h1 class="welcome-title">ğŸŒ± Farm Management</h1>
                <p class="welcome-subtitle">Manage your dairy and poultry operations efficiently</p>
            </div>
            
            <div class="livestock-selection">
                <div class="selection-card" id="dairy-card" data-livestock="dairy">
                    <div class="card-icon">ğŸ„</div>
                    <h3 class="card-title">Dairy Management</h3>
                    <p class="card-description">Track milk production, herd health, and finances</p>
                    <div class="card-stats">
                        <span>ğŸ“Š Production</span>
                        <span>ğŸ’Š Health</span>
                        <span>ğŸ’° Finance</span>
                    </div>
                </div>
                
                <div class="selection-card" id="poultry-card" data-livestock="poultry">
                    <div class="card-icon">ğŸ”</div>
                    <h3 class="card-title">Poultry Management</h3>
                    <p class="card-description">Monitor egg production, flock health, and costs</p>
                    <div class="card-stats">
                        <span>ğŸ¥š Eggs</span>
                        <span>ğŸ’‰ Health</span>
                        <span>ğŸ“ˆ Growth</span>
                    </div>
                </div>
            </div>
            
            <div class="welcome-actions">
                <button id="backup-btn" class="btn-secondary">
                    <span class="btn-icon">ğŸ’¾</span>
                    Create Backup
                </button>
                <button id="restore-btn" class="btn-secondary">
                    <span class="btn-icon">ğŸ”„</span>
                    Restore Backup
                </button>
                <button id="login-btn" class="btn-primary">
                    <span class="btn-icon">ğŸ‘¤</span>
                    Login / Sign Up
                </button>
            </div>
            
            <div class="welcome-footer">
                <p class="offline-status" id="offline-status">âœ… Online - Ready to use</p>
                <p class="app-version">Version 1.0.0 â€¢ PWA Ready</p>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="app-screen" class="screen">
        <!-- Top Header -->
        <header class="app-header">
            <div class="header-left">
                <button id="menu-btn" class="icon-btn">
                    <span>â˜°</span>
                </button>
                <h1 id="page-title">Dashboard</h1>
            </div>
            <div class="header-right">
                <button id="sync-btn" class="icon-btn" title="Sync Status">
                    <span>ğŸ”„</span>
                    <span id="sync-status" class="sync-dot"></span>
                </button>
                <button id="user-btn" class="avatar-btn">
                    <span>ğŸ‘¤</span>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="content-area">
            <!-- Content will be dynamically loaded here -->
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-page="dashboard">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="nav-btn" data-page="history">
                <span class="nav-icon">ğŸ“œ</span>
                <span class="nav-label">History</span>
            </button>
            <button class="nav-btn" data-page="finance">
                <span class="nav-icon">ğŸ’°</span>
                <span class="nav-label">Finance</span>
            </button>
            <button class="nav-btn" data-page="health">
                <span class="nav-icon">â¤ï¸</span>
                <span class="nav-label">Health</span>
            </button>
            <button class="nav-btn" data-page="reports">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-label">Reports</span>
            </button>
            <button class="nav-btn" data-page="settings">
                <span class="nav-icon">âš™ï¸</span>
                <span class="nav-label">Settings</span>
            </button>
        </nav>

        <!-- Floating Action Button -->
        <button id="fab" class="fab">
            <span>+</span>
        </button>

        <!-- FAB Modal -->
        <div id="fab-modal" class="modal">
            <div class="modal-content fab-modal">
                <div class="modal-header">
                    <h3>Add New Record</h3>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <button class="fab-option" data-form="production">
                        <span class="option-icon">ğŸ¥›</span>
                        <div class="option-text">
                            <strong>Production Record</strong>
                            <small>Add milk/egg production</small>
                        </div>
                    </button>
                    <button class="fab-option" data-form="financial">
                        <span class="option-icon">ğŸ’°</span>
                        <div class="option-text">
                            <strong>Financial Transaction</strong>
                            <small>Add income or expense</small>
                        </div>
                    </button>
                    <button class="fab-option" data-form="health">
                        <span class="option-icon">ğŸ’Š</span>
                        <div class="option-text">
                            <strong>Health Record</strong>
                            <small>Add treatment or vaccination</small>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h3>Login / Sign Up</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="padding: 20px; text-align: center;">
                    <p style="margin-bottom: 20px;">Firebase authentication is currently disabled.</p>
                    <p style="color: #666; font-size: 0.9em;">To enable cloud sync, please:</p>
                    <ol style="text-align: left; display: inline-block; margin: 20px auto;">
                        <li>Create a Firebase project</li>
                        <li>Update firebaseConfig in js/app.js</li>
                        <li>Uncomment Firebase scripts in index.html</li>
                    </ol>
                    <button id="close-auth-modal" class="btn-primary" style="margin-top: 20px;">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Production Form Modal -->
    <div id="production-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Production Record</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="production-form">
                    <div class="form-group">
                        <label for="prod-date">Date</label>
                        <input type="date" id="prod-date" required>
                    </div>
                    <div class="form-group">
                        <label for="prod-type">Type</label>
                        <select id="prod-type" required>
                            <option value="milk">Milk Production</option>
                            <option value="eggs">Egg Production</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="prod-quantity">Quantity</label>
                        <input type="number" id="prod-quantity" step="0.01" required placeholder="e.g., 50">
                    </div>
                    <div class="form-group">
                        <label for="prod-unit">Unit</label>
                        <select id="prod-unit">
                            <option value="liters">Liters</option>
                            <option value="eggs">Eggs</option>
                            <option value="kg">Kilograms</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="prod-notes">Notes</label>
                        <textarea id="prod-notes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Save Record</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/db.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/pdf.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Set default date for production form
        document.addEventListener('DOMContentLoaded', function() {
            const prodDate = document.getElementById('prod-date');
            if (prodDate) {
                const today = new Date().toISOString().split('T')[0];
                prodDate.value = today;
            }
            
            // Close auth modal button
            const closeAuthBtn = document.getElementById('close-auth-modal');
            if (closeAuthBtn) {
                closeAuthBtn.addEventListener('click', function() {
                    document.getElementById('auth-modal').classList.remove('active');
                });
            }
        });

        // Clear old service workers first
        if ('serviceWorker' in navigator) {
            // Unregister all existing service workers
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                    console.log('Unregistered old service worker:', registration.scope);
                }
            }).then(() => {
                // Wait, then register new one
                setTimeout(() => {
                    navigator.serviceWorker.register('sw.js')
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                            // Force update
                            registration.update();
                        })
                        .catch(error => {
                            console.log('Service Worker registration failed:', error);
                        });
                }, 1000);
            });
        }

        // Check online status
        window.addEventListener('online', () => {
            const status = document.getElementById('offline-status');
            if (status) status.textContent = 'âœ… Online - Ready to use';
        });

        window.addEventListener('offline', () => {
            const status = document.getElementById('offline-status');
            if (status) status.textContent = 'âš ï¸ Offline - Working locally';
        });
    </script>
</body>
</html>
